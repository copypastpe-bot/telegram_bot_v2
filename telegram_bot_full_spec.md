# Документация по проекту Telegram-бота для учета клиентов, бонусов и заказов

## 1) Описание задачи
Строим внутреннего Telegram-бота для сервиса/студии:
- учет клиентов, лидов и заказов;
- бонусная программа (начисление/списание, подарки на ДР);
- расчёт зарплаты мастеров;
- кассовая книга (доходы/расходы/прибыль);
- массовые рассылки (WhatsApp/Telegram) для лидов и клиентов (ДР, акции).

## 2) Цели проекта
- Упростить ввод данных мастерами («Я выполнил заказ» → бот спрашивает детали → сохраняет в БД).
- Автоматизировать бонусную систему (начисления/списания, ДР-подарки).
- Упростить учет зарплаты мастеров и кассовой книги.
- Снизить ручной труд и ошибки при учете клиентов/заказов.

## 3) Схема БД
**Основные таблицы:**
- `clients`: клиенты (имя, телефон, др, бонусы, статус).
- `orders`: заказы (клиент, мастер, сумма, оплата, бонусы, дата).
- `staff`: сотрудники (мастера, админы, роли, tg_user_id).
- `bonus_transactions`: движение бонусов (начисление, списание, причина).
- `cashbook`: кассовая книга (дата, приход/расход, статья, сумма, комментарий).
- `leads`: лиды (имя, телефон, источник, статус).
- `payroll`: расчет зарплаты мастеров.

## 4) Роли
- **Суперадмин**: полный контроль, управление пользователями, настройками.
- **Админ**: работа с клиентами/заказами, просмотр кассы и ЗП.
- **Мастер**: ввод заказов через бота, просмотр своей статистики.

## 5) Бизнес-процессы
1. Мастер нажимает «Я выполнил заказ» → вводит данные → заказ сохраняется в БД.
2. Автоматически начисляются бонусы клиенту.
3. Автоматически рассчитывается зарплата мастеру.
4. В кассовую книгу пишется приход.
5. Если у клиента день рождения → бот шлет поздравление (WhatsApp).
6. Админ/суперадмин может делать отчеты (касса, ЗП, бонусы).

## 6) Сценарии работы бота
**Для мастера:**
- Кнопка «Я выполнил заказ» → пошаговый ввод.
- Кнопка «Моя статистика» (сумма заказов, ЗП, бонусы).
  
**Для админа:**
- Поиск клиента по номеру.
- Редактирование клиента (имя, др, статус).
- Просмотр кассы.
- Начисление/списание бонусов вручную.

**Для суперадмина:**
- Управление пользователями (мастерами/админами).
- Настройки (правила бонусов, расчета ЗП).

## 7) Интеграции
- WhatsApp API (для поздравлений и рассылок).
- Возможна интеграция с CRM (например, amoCRM).

## 8) Сущности
- **Мастер**: tg_user_id, имя, роль, активность.
- **Клиент**: имя, телефон, бонусы, др, статус.
- **Заказ**: клиент, мастер, сумма, бонусы, оплата, дата.
- **Бонус**: начислено/списано, причина, дата.
- **Касса**: приход/расход, сумма, дата, комментарий.
- **Зарплата**: сумма ЗП, расчет по формулам.

---

# Этапы разработки (MVP → Full)
1. **MVP:**
   - Таблицы БД (`clients`, `orders`, `staff`, `bonus_transactions`).
   - Базовый бот: «/start», «/find», «Я выполнил заказ» (без кассы/ЗП).
   - Логика бонусов (начисление/списание).
2. **Доработки:**
   - Кассовая книга.
   - Расчет ЗП мастеров.
   - Управление ролями (суперадмин → админ → мастер).
   - Массовые рассылки.
3. **Full версия:**
   - Интеграция с WhatsApp API.
   - Отчеты (касса, ЗП, бонусы, продажи).

---

# Пример промтов для Cursor (программиста)
1. «Создай таблицу clients с полями: id, full_name, phone, bonus_balance, birthday, status.»  
2. «Добавь таблицу orders: id, client_id, master_id, amount_total, amount_cash, amount_upsell, bonus_spent, bonus_earned, payment_method, created_at.»  
3. «Сделай в боте кнопку "Я выполнил заказ" → реализуй FSM для пошагового ввода (телефон, сумма, бонусы, способ оплаты).»  
4. «Реализуй начисление бонусов = 5% от оплаты деньгами (MIN 2500 руб, MAX списание бонусами = 50%).»  
5. «Добавь расчет ЗП мастеру: 1000₽ за каждые 3000₽ оплаты, минимум 1000₽ + 150₽ бензин + 500₽ за каждые 3000₽ доп. продажи.»  
6. «Сделай роль суперадмин, который может добавлять/удалять мастеров и админов.»  
